---
import { SEO } from "astro-seo";
import Footer from "@/components/footer.astro";
import Navbar from "@/components/navbar/navbar.astro";
import "@fontsource-variable/inter/index.css";
import "../styles/global.css";

export interface Props {
  title: string;
  visioptPid?: number;
}

const canonicalURL = new URL(Astro.url.pathname, Astro.site).toString();

const resolvedImageWithDomain = new URL(
  "/opengraph.jpg",
  Astro.site
).toString();

const { title, visioptPid } = Astro.props;

const makeTitle = title
  ? title + " | " + "HumTech"
  : "HumTech - AI Solutions for Business";
---

<!doctype html>
<html lang="en">
  <head>
    {visioptPid && (
      <script async type="text/javascript" set:html={`window.visiopt_code=window.visiopt_code||(function(){var visi_wid=1066,visi_pid=${visioptPid},visi_flicker_time=4000,visi_flicker_element='html',c=false,d=document,visi_fn={begin:function(){var a=d.getElementById('visi_flicker');if(!a){var a=d.createElement('style'),b=visi_flicker_element?visi_flicker_element+'{opacity:0!important;background:none!important;}':'',h=d.getElementsByTagName('head')[0];a.setAttribute('id','visi_flicker');a.setAttribute('type','text/css');if(a.styleSheet){a.styleSheet.cssText=b;}else{a.appendChild(d.createTextNode(b));}h.appendChild(a);}},complete:function(){c=true;var a=d.getElementById('visi_flicker');if(a){a.parentNode.removeChild(a);}},completed:function(){return c;},pack:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){visi_fn.complete();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){visi_fn.begin();setTimeout(function(){visi_fn.complete()},visi_flicker_time);this.pack('https://visiopt.com/client/js_test/test.'+visi_wid+'.'+visi_pid+'.js');return true;}};window.visiopt_code_status=visi_fn.init();return visi_fn;}());`} />
    )}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/png" href="/public/logo.png" />
    <meta name="generator" content={Astro.generator} />

    <!-- <link rel="preload" as="image" href={src} alt="Hero" /> -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <SEO
      title={makeTitle}
      description="HumTech - AI solutions to help your business grow with zero risk and guaranteed results."
      canonical={canonicalURL}
      twitter={{
        card: "summary_large_image",
      }}
      openGraph={{
        basic: {
          url: canonicalURL,
          type: "website",
          title: `HumTech - AI Solutions for Business`,
          image: resolvedImageWithDomain,
        },
        image: {
          alt: "HumTech",
        },
      }}
    />
  </head>
  <body class="bg-navy">
    <Navbar />
    <slot />
    <Footer />
    <style is:global>
      /* Improve Page speed */
      /* https://css-tricks.com/almanac/properties/c/content-visibility/ */
      img {
        content-visibility: auto;
      }
    </style>

    <!-- Assessment Modal -->
    <div
      id="assessment-modal"
      style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(25,48,80,0.9); z-index:9999; overflow:auto;">
      <div style="position:relative; width:90%; max-width:900px; height:90vh; margin:5vh auto; background:white; border-radius:12px; overflow:hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <button
          onclick="document.getElementById('assessment-modal').style.display='none'"
          style="position:absolute; top:15px; right:20px; font-size:32px; cursor:pointer; z-index:10000; background:none; border:none; color:#193050; font-weight:bold; line-height:1;"
          aria-label="Close">
          &times;
        </button>
        <iframe
          src="https://assessment.humtech.ai/"
          style="width:100%; height:100%; border:none;"
          title="AI Readiness Assessment">
        </iframe>
      </div>
    </div>

    <script is:inline>
      // Close modal when clicking outside the content
      document.getElementById('assessment-modal')?.addEventListener('click', function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      });

      // Close modal on Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          const modal = document.getElementById('assessment-modal');
          if (modal) modal.style.display = 'none';
        }
      });

      // Global function to open modal
      window.openAssessmentModal = function() {
        window.location.href = '/free-ai-diagnostic';
      };
    </script>
  </body>
</html>
