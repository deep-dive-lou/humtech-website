<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Results</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
        background-color: #061528;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        font-family: Arial, sans-serif;
      }

      #loading-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 32px;
      }

      #loading-screen img {
        width: 160px;
        opacity: 0.95;
      }

      .spinner {
        width: 44px;
        height: 44px;
        border: 3px solid rgba(216, 183, 67, 0.2);
        border-top-color: #D8B743;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
      }

      #status-error {
        display: none;
        color: #E1E4E9;
        font-size: 0.9rem;
        text-align: center;
        max-width: 300px;
        line-height: 1.5;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div id="loading-screen">
      <img src="/public/bg-logo.png" alt="HumTech" />
      <div class="spinner" id="spinner"></div>
      <p id="status-error"></p>
    </div>

    <script>
      const params = new URLSearchParams(window.location.search);
      const submission = params.get("submission");

      if (!submission) {
        document.getElementById("spinner").style.display = "none";
        const err = document.getElementById("status-error");
        err.style.display = "block";
        err.textContent = "Missing submission query parameter.";
      } else {
        fetch(`/api/results?submission=${encodeURIComponent(submission)}`)
          .then(async (response) => {
            let html = await response.text();
            if (!response.ok) {
              throw new Error(html || "Request failed");
            }
            if (!html) {
              throw new Error("No HTML returned");
            }
            // Ensure viewport meta exists
            if (!html.includes('name="viewport"')) {
              html = html.replace(
                /<head>/i,
                '<head><meta name="viewport" content="width=device-width, initial-scale=1">'
              );
            }

            // Inject mobile overflow fixes
            const injectStyles = `<style>
              *, *::before, *::after { box-sizing: border-box; }
              body { overflow-x: hidden; }
              img, video, iframe, table, pre { max-width: 100% !important; height: auto; }
              td, th { word-break: break-word; }
            </style>`;

            html = html.replace(/<\/head>/i, injectStyles + '</head>');

            document.open();
            document.write(html);
            document.close();
          })
          .catch((error) => {
            document.getElementById("spinner").style.display = "none";
            const err = document.getElementById("status-error");
            err.style.display = "block";
            err.textContent = `Error: ${error.message}`;
          });
      }
    </script>
  </body>
</html>
