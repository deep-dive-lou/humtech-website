<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Results</title>
  </head>
  <body>
    <main>
      <h1>Results</h1>
      <p id="status">Loading...</p>
      <div id="results"></div>
    </main>

    <script>
      const statusEl = document.getElementById("status");
      const params = new URLSearchParams(window.location.search);
      const submission = params.get("submission");

      if (!submission) {
        statusEl.textContent = "Missing submission query parameter.";
      } else {
        fetch(`/api/results?submission=${encodeURIComponent(submission)}`)
          .then(async (response) => {
            const data = await response.json();
            if (!response.ok) {
              throw new Error(data?.error || "Request failed");
            }
            if (!data.html) {
              throw new Error("No HTML returned");
            }
            document.open();
            document.write(data.html);
            document.close();
          })
          .catch((error) => {
            statusEl.textContent = `Error: ${error.message}`;
          });
      }
    </script>
  </body>
</html>
